(function(e){var a=function(){var a={};var l,n,t,i,o,d,s,r,f,u,c,h,p,b,x,m={},y,w,g,M,v,k,z,G,P,I,R,B,T,C,E,F,O,S,L,q,D,A,H,X;var j,W;var J,K,N;H=function(e,a){var l=new XMLHttpRequest;if(l.withCredentials!==undefined){l.open(e,a,true)}else if(XDomainRequest!=="undefined"){l=new XDomainRequest;l.open(e,a)}else{l=null}return l};S=function(e){return e>0?1:e<0?-1:0};O=function(){L();p.ball_locked=true;p.state="not-started";if(typeof p.onGameOver==="function"){p.onGameOver(true)}};F=function(){G("unpause");p.state="running";if(typeof p.onGamePaused==="function"){p.onPaused(false)}};C=function(){L();p.state="not-started";if(typeof p.onGameOver==="function"){p.onGameOver(false)}};E=function(){G("pause");p.state="paused";if(typeof p.onGamePaused==="function"){p.onGamePaused(true)}};z=function(e){if(typeof p.onGameFlash==="function"){p.onGameFlash(e)}};T=function(){p.points=x.points;if(typeof p.onGamePoints==="function"){p.onGamePoints(p.points)}};n=function(e){p.points+=e*p.bonus_multiplier;if(typeof p.onGamePoints==="function"){p.onGamePoints(p.points)}};B=function(){p.lives=x.lives;if(typeof p.onGameLives==="function"){p.onGameLives(p.lives)}};I=function(e){var a;p.lives-=e;if(typeof p.onGameLives==="function"){p.onGameLives(p.lives)}if(!p.lives){C()}else{L();if(p.lives>1){a=p.lives+" lives remaining"}else{a="One life remaining"}z(a);p.ball_locked=true}};l=function(e,a){p.bonus_multiplier+=a;z(e);if(typeof p.onGameBonus==="function"){p.onGameBonus(p.bonus_multiplier,p.num_bonuses-p.bonuses.length)}};R=function(){p.bonus_multiplier=x.bonus_multiplier;p.bonuses=_.range(x.num_bonuses);p.paddle=_.cloneDeep(x.paddle);p.ball=_.cloneDeep(x.ball);p.fall_interval=x.fall_interval;p.brick_bounce=true;if(typeof p.onGameBonus==="function"){p.onGameBonus(p.bonus_multiplier,p.num_bonuses-p.bonuses.length)}};g=function(e){var a;a=e%p.ascii_colors.length;return p.ascii_colors[a]};D=function(e){var a;switch(p.state){case"running":if(p.m_timeout!==null){clearTimeout(p.m_timeout)}p.m_timeout=setTimeout(function(){p.m_timeout=null;p.paddle_dir=0},50);if(e.targetTouches){a=e.targetTouches[0].pageX}else{a=e.pageX}if(a>p.mouse_min_x&&a<p.mouse_max_x){if(a-p.mouse_min_x<p.paddle_x){p.paddle_dir=-1}else if(a-p.mouse_min_x>p.paddle_x){p.paddle_dir=1}p.l_paddle_x=p.paddle_x;p.paddle_x=a-p.mouse_min_x}break}};u=function(e,a){var l,n,t,i,o,d,r,f,u,c,h;s.save();s.translate(p.l_x+p.ball.w_h,p.l_y+p.ball.h_h);s.rotate(p.l_ball_angle);s.clearRect(-p.ball.w_h-p.p_char_w,-p.ball.h_h-p.p_font_size,p.ball.w+p.p_char_w*3,p.ball.h+p.p_font_size*3);s.restore();s.fillStyle=p.paddle_color;s.save();s.translate(e+p.ball.w_h,a+p.ball.h_h);s.rotate(p.ball_angle);u=_.times(p.ball.cols,function(){return"O"}).join("");for(f=0;f<p.ball.rows;f++){s.fillText(u,-p.ball.w_h,-p.ball.h_h+f*p.p_font_size)}s.restore();if(p.loop_cnt%p.ball_spin_speed===0){p.l_ball_angle=p.ball_angle;p.ball_angle+=p.ball_spin*p.ball_da;c=[p.x,p.y];h=[p.x+p.ball.w,p.y];t=[p.x+p.ball.w,p.y+p.ball.h];n=[p.x,p.y+p.ball.h];l=M(c,h,t,n);o=Math.floor(Math.max.apply(null,_.zip.apply(_,l)[1]));r=Math.ceil(Math.min.apply(null,_.zip.apply(_,l)[1]));i=Math.floor(Math.max.apply(null,_.zip.apply(_,l)[0]));d=Math.ceil(Math.min.apply(null,_.zip.apply(_,l)[0]));if(d<0){p.x-=d}if(i>p.w){p.x-=i-p.w}if(r<0){p.y-=r}if(o>p.h-p.paddle.h){p.y-=o-(p.h-p.paddle.h)}}};k=function(e,a,l,n){if(a<0){return Math.max(n,e+a)}if(a>=0){return Math.min(l,e+a)}};c=function(e){var a;s.clearRect(0,p.h-p.paddle.h-1,p.w,p.paddle.h+1);s.fillStyle=p.paddle_color;a="["+_.times(p.paddle.cols-2,function(){return"O"}).join("")+"]";s.fillText(a,e,p.h-p.paddle.h)};Figlet.loadFont=function(e,a){var l,n;l="fonts/"+e+".flf";n=H("GET",l);n.onload=function(){if(n.status>=200&&n.status<400){a(n.responseText)}};n.send()};y=function(e){p.board_disp=[];Figlet.parsePhrase(e,p.figlet_font,function(e,a,l,n){p.space_w=l;if(p.wrap){n=o(e,a)}p.board_disp=i(e,n,a,l);L()})};o=function(e,a){var l,n,t,i,o;t=[];i=0;n=false;if(!e||e.length===0){return[]}for(l=0,o=e[0].length;l<o;l++){i+=p.char_w;if(i<p.w){if(a.indexOf(l)>=0){n=l}}else if(i>p.w){if(n){t.push(n);i=p.char_w*(l-n);n=false}else{t.push(l);i=0}}}if(t.length===0){t.push(e[0].length)}else if(t[t.length-1]<e[0].length){t.push(e[0].length)}return t};t=function(e,a){var l,t,i,o,_,d,s,r,f,u;u=p.ball.cols===p.ball.rows;i=p.x;o=p.y;var c=p.p_char_w*p.ball.cols;var h=p.p_font_size*p.ball.rows;t=[i,o];d=[i+c,o];l=[i+c,o+h];s=[i,o+h];_=M(t,d,l,s);r={x1:u?t[0]+p.dx:_[0][0]+p.dx,y1:u?t[1]+p.dy:_[0][1]+p.dy,x2:u?l[0]+p.dx:_[2][0]+p.dx,y2:u?l[1]+p.dy:_[2][1]+p.dy};f={x1:e,y1:a,x2:e+p.char_w,y2:a+p.font_size};if(Rectangles.intersect(Rectangles.normalize(r),Rectangles.normalize(f))){n(1);var b=[Math.round(t[0]+c/2),Math.round(t[1]+h/2)];return[b[0]-p.dx,b[1]-p.dy]}return false};v=function(e,a,l){var n,t,i;if(!p.brick_bounce){return true}t=a+p.char_w_h;i=l+p.font_size_h;n=Math.atan2(e[1]-i,e[0]-t);if(n<=Math.PI/4&&n>-Math.PI/4){if(p.dx<=0){p.dx=-p.dx}}else if(n<=-Math.PI/4&&n>-3*Math.PI/4){if(p.dy>=0){p.dy=-p.dy}}else if(n<=-3*Math.PI/4&&n>=-Math.PI||n<=Math.PI&&n>=3*Math.PI/4){if(p.dx>=0){p.dx=-p.dx}}else if(n<=3*Math.PI/4&&n>Math.PI/4){if(p.dy<=0){p.dy=-p.dy}}};i=function(e,a,l,n){var t,i,o,_,d,s,r,f,u,c,h,p;t=[];_=0;o=0;f=0;for(u=0,h=a.length;u<h;u++){i=a[u];for(s=c=0,p=e.length;c<p;s=++c){d=e[s];if(l.indexOf(i)>=0&&o!==0){f=n}r=d.slice(o+f,i);t[s+_*e.length]=r}o=i;_+=1}return t};P=function(){var e,a,l,n,i,o,_,s,r,f,u,c;var h={x:undefined,y:undefined};var b={x:undefined,y:undefined};var x,m;_=0;l=true;c=p.board_disp;for(i=s=0,f=c.length;s<f;i=++s){n=c[i];o=p.w_h-Math.round(n.length*p.char_w/2);for(a=r=0,u=n.length;r<u;a=++r){e=n[a];if(e!==" "){l=false;x=t(o,_);if(x){m=x;if(h.x===undefined){h={x:o,y:_};b={x:o+p.char_w,y:_+p.font_size}}else{h.x=o<h.x?o:h.x;h.y=_<h.y?_:h.y;b.x=o+p.char_w>b.x?o+p.char_w:b.x;b.y=_+p.font_size>b.y?_+p.font_size:b.y}p.board_disp[i][a]=" ";d.clearRect(o,_,p.char_w,p.font_size)}}o+=p.char_w}_+=p.font_size}if(m){G("hit");var y=h.x+Math.round((b.x-h.x)/2);var w=h.y+Math.round((b.y-h.y)/2);v(m,y,w)}return p.block_rotations.length===0&&l};f=function(){if(p.loop_cnt-p.last_bonus<p.bonus_cooldown){G("hit");return}G("upgrade");p.last_bonus=p.loop_cnt;if(p.bonuses.length===0){R()}switch(p.bonuses.pop()){case 0:l("Small Paddle!",10);p.paddle.cols=5;break;case 1:l("Double Paddle!",2);p.brick_bounce=true;p.paddle.cols=p.paddle.cols*2;break;case 2:l("Small ball!",5);p.ball.cols=1;p.ball.rows=1;break;case 3:l("More falling bricks!",0);p.fall_interval=10;break;case 4:l("Super ball!!",0);p.brick_bounce=false;p.ball.cols=4;p.ball.rows=4;break;case 5:l("Long ball!!",0);p.brick_bounce=true;p.ball.cols=1;p.ball.rows=4;break}L()};h=function(){var e,a,l,t,i,o,_,s,r;e=function(e){d.save();d.translate(e.x+p.char_w_h,e.l_y+p.font_size_h);d.rotate(e.l_r);d.clearRect(-p.char_w_h-p.char_w,-p.font_size_h-p.font_size,p.char_w*3,p.font_size*3);d.restore()};p.block_rotations=p.block_rotations.filter(function(e){return e.d===true});p.block_rotations.forEach(function(a){if(a.y+p.font_size>p.h-p.paddle.h&&(a.x+p.char_w>p.paddle_x&&a.x<p.paddle_x+p.paddle.w)){a.d=false;n(1);f();L()}else{if(p.state==="running"){if(p.loop_cnt%a.s===0){if(a.l_y){e(a)}d.save();d.translate(a.x+p.char_w_h,a.y+p.font_size_h);d.rotate(a.r);d.fillText(a.c,-p.char_w_h,-p.font_size_h);d.restore();a.l_y=a.y;a.y+=p.font_size;a.l_r=a.r;a.r+=Math.PI/4;if(a.y>p.h){a.d=false;e(a)}}}}});if(p.state==="running"){if(p.loop_cnt%p.fall_interval===0){p.board_disp.forEach(function(e,a){if(e.some(function(e){return e!==" "})){p.l_char_row_index=a}});l=p.board_disp[p.l_char_row_index];t=[];for(a=s=0,r=l.length;s<r;a=++s){o=l[a];if(o!==" "){t.push(a)}}if(t.length===0){return}i=t[Math.floor(Math.random()*t.length)];_=p.w_h-Math.round(l.length*p.char_w/2);p.block_rotations.push({x:_+p.char_w*i,y:p.l_char_row_index*p.font_size+p.font_size,l_y:null,l_r:null,r:0,rs:Math.floor(Math.random()*10+3),c:l[i],s:p.fall_speed(),d:true});l[i]=" ";d.clearRect(_+p.char_w*i,p.l_char_row_index*p.font_size,p.char_w,p.font_size)}}};r=function(){var e,a,l;l=0;p.board_disp.forEach(function(n,t){a=p.w_h-Math.round(n.length*p.char_w/2);e=g(t);if(n.some(function(e){return e!==" "})){p.l_char_row_index=t}d.fillStyle=e;d.fillText(n.join(""),a,l);l+=p.font_size})};M=function(e,a,l,n){var t,i,o,_;if(Math.round(100*p.ball_angle)%Math.round(100*Math.PI)===0){return[e,a,l,n]}o=p.x+p.ball.w_h;_=p.y+p.ball.h_h;t=Math.cos(-p.ball_angle);i=Math.sin(-p.ball_angle);return[[o+(e[0]-o)*t+(e[1]-_)*i,_-(e[0]-o)*i+(e[1]-_)*t],[o+(a[0]-o)*t+(a[1]-_)*i,_-(a[0]-o)*i+(a[1]-_)*t],[o+(l[0]-o)*t+(l[1]-_)*i,_-(l[0]-o)*i+(l[1]-_)*t],[o+(n[0]-o)*t+(n[1]-_)*i,_-(n[0]-o)*i+(n[1]-_)*t]]};w=function(){var e,a,l,n,t,i,o;i=[p.x,p.y];o=[p.x+p.ball.w,p.y];t=[p.x+p.ball.w,p.y+p.ball.h];n=[p.x,p.y+p.ball.h];e=M(i,o,t,n);a=Math.floor(Math.max.apply(null,_.zip.apply(_,e)[1]));l=Math.ceil(Math.min.apply(null,_.zip.apply(_,e)[1]));return a-l};b=function(){var e,a,l,n,t,i,o,d,s,r;if(p.state==="running"){r=P();if(r&&p.board_disp.length>0){O()}if(p.ball_locked){p.l_x=p.x;p.l_y=p.y;p.ball_angle=x.ball_angle;p.ball_spin=x.ball_spin;p.dx=x.dx;p.dy=x.dy;p.x=p.paddle_x+p.paddle.w_h-p.ball.w_h;p.y=p.h-p.paddle.h-p.ball.h-(w()/2-p.ball.h_h)}if(p.l_char_row_index>=0){h()}u(p.x,p.y);if(p.right_down){if(p.paddle_x+p.paddle.w<p.w){p.l_paddle_x=p.paddle_x;p.paddle_x+=Math.floor(5+p.right_acc);p.right_acc+=p.acc_rate}}else if(p.left_down){if(p.paddle_x>0){p.paddle_x-=Math.floor(5+p.left_acc);p.left_acc+=p.acc_rate}}c(p.paddle_x);d=[p.x,p.y];s=[p.x+p.ball.w,p.y];l=[p.x+p.ball.w,p.y+p.ball.h];a=[p.x,p.y+p.ball.h];e=M(d,s,l,a);t=Math.floor(Math.max.apply(null,_.zip.apply(_,e)[1]));o=Math.ceil(Math.min.apply(null,_.zip.apply(_,e)[1]));n=Math.ceil(Math.max.apply(null,_.zip.apply(_,e)[0]));i=Math.floor(Math.min.apply(null,_.zip.apply(_,e)[0]));if(n+p.dx>p.w){G("bounce");if(!p.ball_spin||S(p.dy)===S(p.ball_spin)){p.dy=k(p.dy,-p.ball_spin*2,p.max_dy,-p.max_dy);p.ball_spin=k(p.ball_spin,-p.dy,p.ball_max_spin,-p.ball_max_spin)}p.dx=-p.dx}if(i+p.dx<0){G("bounce");if(!p.ball_spin||S(p.dy)!==S(p.ball_spin)){p.dy=k(p.dy,p.ball_spin*2,p.max_dy,-p.max_dy);p.ball_spin=k(p.ball_spin,p.dy,p.ball_max_spin,-p.ball_max_spin)}p.dy=S(p.dy)*Math.max(Math.abs(p.dy),Math.abs(x.dy));p.dx=-p.dx}if(o+p.dy<0){G("bounce");if(!p.ball_spin||S(p.dx)===S(p.ball_spin)){p.dx=k(p.dx,-p.ball_spin*2,p.max_dx,-p.max_dx);p.ball_spin=k(p.ball_spin,-p.dx,p.ball_max_spin,-p.ball_max_spin)}p.dy=S(p.dy)*Math.max(Math.abs(p.dy),Math.abs(x.dy));p.dy=-p.dy}else if(t+p.dy>p.h-p.paddle.h){if(n>p.paddle_x-p.char_w&&i<p.paddle_x+p.paddle.w+p.char_w){G("paddle");if(!p.ball_spin||S(p.dx)!==S(p.ball_spin)){p.dx=k(p.dx,p.ball_spin*2,p.max_dx,-p.max_dx);p.ball_spin=k(p.ball_spin,p.dx,p.ball_max_spin,-p.ball_max_spin)}p.dx=k(p.dx,-p.paddle_dir*2,p.max_dx,-p.max_dx);p.ball_spin=k(p.ball_spin,-p.paddle_dir,p.ball_max_spin,-p.ball_max_spin);if(p.x+p.ball.w<p.paddle_x+p.p_char_w){p.dx=-p.max_dx;p.ball_spin=-p.ball_max_spin}if(p.x>p.paddle_x+p.paddle.w-p.p_char_w){p.dx=p.max_dx;p.ball_spin=p.ball_max_spin}p.dy=-p.dy;p.dy=S(p.dy)*Math.max(Math.abs(p.dy),Math.abs(x.dy))}else{G("death");if(p.state==="running"){I(1)}p.dy=-p.dy}}if(!p.ball_locked){p.l_x=p.x;p.l_y=p.y;p.x+=p.dx;p.y+=p.dy}}p.loop_cnt+=1};x={onGameWin:undefined,onGameFlash:undefined,onGameStart:undefined,onGameOver:undefined,onGamePaused:undefined,onGamePoints:undefined,onGameLives:undefined,onGameBonus:undefined,onToggleSound:undefined,wrap:false,size_to_parent:true,container_id:"breakout",game_canvas_id:"game-canvas",brick_canvas_id:"brick-canvas",font_name:"Monospace",game_str:"Hello, this is figlet breakout!",figlet_font:"Pebbles",acc_rate:.5,w:800,h:600,dx:0,dy:-6,max_dx:6,max_dy:8,x:-1e3,y:-1e3,l_x:-1,bonus_cooldown:500,last_bonus:0,num_bonuses:6,bonuses:_.range(6),right_down:false,left_down:false,right_acc:0,left_acc:0,state:"not-started",paddle_color:"white",board_disp:[],space_w:0,ball:{cols:3,rows:3,w:0,h:0},paddle:{cols:9,rows:1,w:0,h:10},width:0,height:0,mouse_min_x:0,mouse_max_x:0,ascii_colors:["#c84848","#c66c3a","#b47a30","#a2a22a","#48a048"],font_size:12,p_font_size:12,ball_locked:true,ball_spin:0,ball_angle:0,l_ball_angle:0,ball_da:Math.PI/16,ball_spin_speed:2,ball_max_spin:1,l_char_row_index:0,loop_cnt:0,block_rotations:[],fall_interval:50,fall_speed:function(){return Math.floor(Math.random()*10+p.font_size/3)},bonus_multiplier:1,points:0,lives:3,brick_bounce:true,paddle_x:undefined,paddle_dir:0,m_timeout:null,sound_enabled:false,sound:new Howl({src:["../sounds/mygameaudio.ogg","../sounds/mygameaudio.m4a","../sounds/mygameaudio.mp3","../sounds/mygameaudio.ac3"],sprite:{bounce:[0,636.054421768707],death:[2e3,597.1655328798184],hit:[4e3,33.922902494331],paddle:[6e3,81.541950113379],pause:[8e3,439.818594104308],unpause:[1e4,439.818594104308],upgrade:[12e3,297.142857142857]}})};L=function(){K.width=p.w;K.height=p.h;N.width=p.w;N.height=p.h;p.w_h=Math.ceil(p.w/2);p.h_h=Math.ceil(p.h/2);p.mouse_min_x=K.getBoundingClientRect().left;p.mouse_max_x=p.mouse_min_x+p.w-p.paddle.w;d.textBaseline="top";s.textBaseline="top";d.font=p.font_size+"px "+p.font_name;s.font=p.p_font_size+"px "+p.font_name;p.char_w=d.measureText("O").width;p.p_char_w=s.measureText("O").width;p.char_w_h=Math.round(p.char_w/2);p.p_char_w_h=Math.round(p.p_char_w/2);p.font_size_h=Math.round(p.font_size/2);p.p_font_size_h=Math.round(p.p_font_size/2);p.ball.w=p.ball.cols*p.p_char_w;p.ball.w_h=Math.round(p.ball.w/2);p.ball.h=p.ball.rows*p.p_font_size;p.ball.h_h=Math.round(p.ball.h/2);p.paddle.w=p.paddle.cols*p.p_char_w;p.paddle.w_h=Math.round(p.paddle.w/2);p.paddle.h=p.paddle.rows*p.p_font_size;p.paddle.h_h=Math.round(p.paddle.h/2);if(!p.paddle_x){p.l_paddle_x=p.paddle_x;p.paddle_x=p.w_h-p.paddle.w_h}r()};G=function(e){if(p.sound_enabled){p.sound.play(e)}};q=function(e,a,l){if(a.addEventListener){a.addEventListener(e,l,false)}else{a.attachEvent("on"+e,l)}};X=function(e){_.merge(x,m);if(e){_.merge(x,e)}p=_.cloneDeep(x,true);a.game=p;R();B();T();J=document.getElementById(p.container_id);if(p.size_to_parent){p.w=J.clientWidth;p.h=J.clientHeight}L();y(p.game_str);return p};A=function(){q("keydown",document,function(e){switch(p.state){case"paused":if(e.keyCode===27){F()}break;case"running":if(e.keyCode===27){E()}if(e.keyCode===32){p.ball_locked=false}break}if(e.keyCode===39){p.right_down=true;p.paddle_dir=1}else if(e.keyCode===37){p.left_down=true;p.paddle_dir=-1}else if(e.keyCode===83){p.sound_enabled=!p.sound_enabled;if(typeof p.onToggleSound==="function"){p.onToggleSound(p.sound_enabled)}}});q("keyup",document,function(e){if(e.keyCode===39){p.right_down=false;p.right_acc=0;p.paddle_dir=0}else if(e.keyCode===37){p.left_down=false;p.left_acc=0;p.paddle_dir=0}});q("click",document.getElementById("breakout"),function(){switch(p.state){case"running":if(p.ball_locked){p.ball_locked=false}else{E()}break;case"paused":F();break}});q("mousemove",document.getElementById("breakout"),D);q("touchmove",document.getElementById("breakout"),D)};a.init=function(a,l){this.reset=X;m=a;K=document.createElement("canvas");K.id="game-canvas";K.style.position="absolute";N=document.createElement("canvas");N.id="brick-canvas";N.style.position="absolute";s=K.getContext("2d");d=N.getContext("2d");X();this.play=function(){F();if(typeof p.onGameStart==="function"){p.onGameStart()}};J=document.getElementById(p.container_id);if(p.size_to_parent){p.w=J.clientWidth;p.h=J.clientHeight}J.appendChild(K);J.appendChild(N);j=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||null;if(j!==null){W=function(){b();j(W,K)};j(W,K)}else{setInterval(b,1e3/60)}A();if(typeof l==="function"){l()}};return a};if(e.FigletBreakout===undefined){e.FigletBreakout=a()}})(window);